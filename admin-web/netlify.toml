# Admin Web - Static site with Netlify Functions
# IMPORTANT: This is NOT a Next.js app - disable framework detection

[build]
  command = "echo 'No build needed - static HTML + serverless functions'"
  publish = "."

[build.environment]
  # Explicitly disable Next.js runtime
  NETLIFY_NEXT_PLUGIN_SKIP = "true"

[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"
  # External modules that should not be bundled
  external_node_modules = ["@libsql/client", "bcryptjs", "jsonwebtoken"]

# ── Auth ──
[[redirects]]
  from = "/api/auth/login"
  to = "/.netlify/functions/auth-login"
  status = 200

[[redirects]]
  from = "/api/auth/setup-first-admin"
  to = "/.netlify/functions/auth-setup-first-admin"
  status = 200

# ── Admin (specific paths before wildcards) ──
[[redirects]]
  from = "/api/admin/stock/bulk"
  to = "/.netlify/functions/admin-stock"
  status = 200

[[redirects]]
  from = "/api/admin/stock/*"
  to = "/.netlify/functions/admin-stock"
  status = 200

[[redirects]]
  from = "/api/admin/stock"
  to = "/.netlify/functions/admin-stock"
  status = 200

[[redirects]]
  from = "/api/admin/orders/*"
  to = "/.netlify/functions/admin-orders"
  status = 200

[[redirects]]
  from = "/api/admin/orders"
  to = "/.netlify/functions/admin-orders"
  status = 200

[[redirects]]
  from = "/api/admin/users/*"
  to = "/.netlify/functions/admin-users"
  status = 200

[[redirects]]
  from = "/api/admin/users"
  to = "/.netlify/functions/admin-users"
  status = 200

[[redirects]]
  from = "/api/admin/audit-logs"
  to = "/.netlify/functions/admin-audit-logs"
  status = 200

[[redirects]]
  from = "/api/admin/export/*"
  to = "/.netlify/functions/admin-export"
  status = 200

# ── Ops ──
[[redirects]]
  from = "/api/ops/renew/*"
  to = "/.netlify/functions/ops-renew"
  status = 200

[[redirects]]
  from = "/api/ops/step/*"
  to = "/.netlify/functions/ops-step"
  status = 200

[[redirects]]
  from = "/api/ops/today"
  to = "/.netlify/functions/ops-today"
  status = 200

[[redirects]]
  from = "/api/ops/renewals"
  to = "/.netlify/functions/ops-renewals"
  status = 200

[[redirects]]
  from = "/api/ops/message-log"
  to = "/.netlify/functions/ops-message-log"
  status = 200

# ── Sync ──
[[redirects]]
  from = "/api/sync/push"
  to = "/.netlify/functions/sync-push"
  status = 200

[[redirects]]
  from = "/api/sync/pull"
  to = "/.netlify/functions/sync-pull"
  status = 200

[[redirects]]
  from = "/api/sync/pull-readonly"
  to = "/.netlify/functions/sync-pull-readonly"
  status = 200
