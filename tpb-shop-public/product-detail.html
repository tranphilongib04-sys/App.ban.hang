<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ti·∫øt s·∫£n ph·∫©m - Ti·ªám B·∫£n Quy·ªÅn</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/products.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-inner">
            <a href="index.html" class="logo">Ti·ªám B·∫£n Quy·ªÅn</a>
            <nav class="nav-menu">
                <a href="products.html" class="nav-link">S·∫£n ph·∫©m</a>
                <a href="index.html#pricing" class="nav-link">B·∫£ng gi√°</a>
                <a href="history.html" class="nav-link">ƒê∆°n h√†ng</a>
            </nav>
            <div class="nav-actions">
                <a href="https://zalo.me/0918161862" class="nav-link" target="_blank">H·ªó tr·ª£</a>
                <button class="nav-cart" id="cartBtn" aria-label="Gi·ªè h√†ng">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                    </svg>
                    <span class="nav-cart-count" id="cartCount">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Product Detail Content -->
    <div class="product-detail-page" id="productDetail">
        <!-- Rendered by JS -->
        <div style="height: 60vh; display: flex; align-items: center; justify-content: center;">
            ƒêang t·∫£i th√¥ng tin s·∫£n ph·∫©m...
        </div>
    </div>

    <!-- Related Products -->
    <section style="background: var(--color-bg-alt); padding: 80px 0;">
        <div class="container">
            <h2 class="headline-section text-center fade-in">C√≥ th·ªÉ b·∫°n c≈©ng th√≠ch</h2>
            <div class="catalog-grid" id="relatedGrid" style="margin-top: 40px;">
                <!-- Rendered by JS -->
            </div>
        </div>
    </section>

    <!-- Cart Modal -->
    <div class="cart-overlay" id="cartOverlay"></div>
    <div class="cart-modal" id="cartModal">
        <div class="cart-header">
            <h3 class="cart-title">Gi·ªè h√†ng</h3>
            <button class="cart-close" id="cartClose">√ó</button>
        </div>
        <div class="cart-items" id="cartItems"></div>
        <div class="cart-footer">
            <div class="cart-total">
                <span class="cart-total-label">T·ªïng c·ªông</span>
                <span class="cart-total-amount" id="cartTotal">0ƒë</span>
            </div>
            <a href="checkout.html" class="btn btn-primary cart-checkout" id="checkoutBtn">Thanh to√°n</a>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-inner">
                <a href="index.html" class="logo">Ti·ªám B·∫£n Quy·ªÅn</a>
                <nav class="footer-links">
                    <a href="products.html" class="footer-link">S·∫£n ph·∫©m</a>
                    <a href="history.html" class="footer-link">ƒê∆°n h√†ng</a>
                    <a href="https://zalo.me/0918161862" class="footer-link" target="_blank">H·ªó tr·ª£ Zalo</a>
                </nav>
                <p class="footer-copyright">¬© 2026 Ti·ªám B·∫£n Quy·ªÅn</p>
            </div>
        </div>
    </footer>

    <!-- Toast -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="js/main.js"></script>
    <script src="js/products.js"></script>

    <script>
        // --- Product Detail Page Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            // Default ID if none provided, or get from URL
            let productId = urlParams.get('id');

            // If no ID or invalid, redirect to catalog
            if (!productId && CATALOG.length > 0) {
                // Fallback for demo: load first product if no ID
                // productId = CATALOG[0].id; // Uncomment to debug without params
                window.location.href = 'products.html';
                return;
            }

            const product = getProductById(productId);
            if (!product) {
                document.getElementById('productDetail').innerHTML = '<div style="text-align:center; padding:50px;">S·∫£n ph·∫©m kh√¥ng t·ªìn t·∫°i <br><a href="products.html">Quay l·∫°i</a></div>';
                return;
            }

            // Find all variants (same groupId)
            // Assuming we added 'groupId' to products.js. If not present, we filter by name prefix or simple logic
            // For V3, let's treat same-name products as variants
            const variants = CATALOG.filter(p => p.name === product.name);

            renderProductDetail(product, variants);
            renderRelatedCheck(product);
        });

        function renderProductDetail(product, variants) {
            const container = document.getElementById('productDetail');
            const discount = getDiscount(product.originalPrice, product.price);

            // Generate variants HTML
            // Sort by duration length roughly or just index
            const variantsHtml = variants.map(v => `
                <div class="duration-opt ${v.id === product.id ? 'active' : ''}" 
                     onclick="window.location.href='product-detail.html?id=${v.id}'">
                    <span class="opt-time">${v.duration}</span>
                    <span class="opt-price">${formatPrice(v.price)}</span>
                </div>
            `).join('');

            // Generate Features List
            const featuresList = (product.features || []).map(f => `
                <div class="feature-item">
                    <span class="feature-icon">‚úì</span>
                    <span>${f}</span>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="detail-hero fade-in">
                    <!-- Left: Image -->
                    <div class="detail-gallery">
                        <img src="${product.logo}" alt="${product.name}">
                    </div>

                    <!-- Right: Info -->
                    <div class="detail-info">
                        <span class="detail-cat">${product.categoryLabel}</span>
                        <h1>${product.name}</h1>
                        <p style="color:var(--color-text-secondary); margin-bottom:20px;">
                            ${product.desc}
                        </p>

                        <div class="detail-price-box">
                            <span class="detail-price">${formatPrice(product.price)}</span>
                            <span class="detail-price-original">${formatPrice(product.originalPrice)}</span>
                            <span class="detail-tag">-${discount}%</span>
                        </div>

                        <!-- Variants Selector -->
                        <span class="group-label">Ch·ªçn th·ªùi h·∫°n:</span>
                        <div class="duration-selector">
                            ${variantsHtml}
                        </div>

                        <!-- Actions -->
                        <div class="detail-actions">
                            <button class="btn-buy-now" onclick="buyNow('${product.id}')">Mua ngay</button>
                            <button class="btn-add-cart" onclick="addToCart('${product.id}')">Th√™m v√†o gi·ªè</button>
                        </div>
                        <p style="font-size:13px; color:var(--color-text-secondary); margin-top:16px; text-align:center;">
                            üîí B·∫£o h√†nh tr·ªçn ƒë·ªùi ‚Ä¢ Giao h√†ng t·ª± ƒë·ªông
                        </p>
                    </div>
                </div>

                <!-- Tabs Content -->
                <div class="detail-content fade-in">
                    <div class="content-tabs">
                        <button class="tab-btn active" onclick="switchTab('desc')">Th√¥ng tin chi ti·∫øt</button>
                        <button class="tab-btn" onclick="switchTab('manual')">H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</button>
                        <button class="tab-btn" onclick="switchTab('warranty')">Ch·∫ø ƒë·ªô b·∫£o h√†nh</button>
                    </div>

                    <div id="tab-desc" class="tab-pane active rich-text">
                        <h3>T√≠nh nƒÉng n·ªïi b·∫≠t</h3>
                        <div class="feature-list" style="margin-bottom:30px;">
                            ${featuresList}
                        </div>
                        <h3>M√¥ t·∫£ s·∫£n ph·∫©m</h3>
                        ${product.longDescription || ''}
                    </div>

                    <div id="tab-manual" class="tab-pane rich-text">
                        <h3>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h3>
                        ${product.manual || '<p>ƒêang c·∫≠p nh·∫≠t...</p>'}
                    </div>

                    <div id="tab-warranty" class="tab-pane rich-text">
                        <h3>Ch√≠nh s√°ch b·∫£o h√†nh</h3>
                        <p>${product.warranty || 'B·∫£o h√†nh ƒë·∫ßy ƒë·ªß theo ch√≠nh s√°ch c·ªßa Ti·ªám B·∫£n Quy·ªÅn.'}</p>
                        <p><strong>Cam k·∫øt:</strong></p>
                        <ul>
                            <li>T√†i kho·∫£n ch√≠nh ch·ªß, s·∫°ch 100%.</li>
                            <li>H·ªó tr·ª£ k·ªπ thu·∫≠t trong su·ªët qu√° tr√¨nh s·ª≠ d·ª•ng.</li>
                            <li>Ho√†n ti·ªÅn n·∫øu kh√¥ng kh·∫Øc ph·ª•c ƒë∆∞·ª£c l·ªói.</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function switchTab(tabId) {
            // Update buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }

        function renderRelatedCheck(currentProduct) {
            const related = getRelatedProducts(currentProduct);
            const grid = document.getElementById('relatedGrid');
            if (related.length === 0) {
                document.getElementById('relatedGrid').parentElement.style.display = 'none';
                return;
            }

            grid.innerHTML = related.map(product => `
                <div class="catalog-card" onclick="window.location.href='product-detail.html?id=${product.id}'" style="cursor:pointer">
                    <div class="catalog-card-image">
                        <img src="${product.logo}" alt="${product.name}">
                    </div>
                    <div class="catalog-card-body">
                         <span class="catalog-card-category">${product.categoryLabel}</span>
                        <h3 class="catalog-card-title">${product.name}</h3>
                         <div class="catalog-card-footer">
                            <span class="catalog-card-price">${formatPrice(product.price)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>

</html>